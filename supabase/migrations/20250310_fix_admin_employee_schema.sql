-- Create the missing table to resolve the 'Could not find table' error
CREATE TABLE IF NOT EXISTS public.data_karyawan_admin_pabrik (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    kode TEXT NOT NULL,
    nama TEXT NOT NULL,
    jenis_kelamin TEXT DEFAULT 'L',
    jabatan TEXT,
    divisi TEXT,
    perusahaan TEXT DEFAULT 'CV GARUT',
    bulan TEXT,
    keterangan TEXT,
    status_aktif BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT unique_kode_bulan_admin UNIQUE (kode, bulan)
);

-- Enable Row Level Security
ALTER TABLE public.data_karyawan_admin_pabrik ENABLE ROW LEVEL SECURITY;

-- Create access policy
DROP POLICY IF EXISTS "Public Access Admin Data" ON public.data_karyawan_admin_pabrik;
CREATE POLICY "Public Access Admin Data" ON public.data_karyawan_admin_pabrik
    FOR ALL USING (true) WITH CHECK (true);

GRANT ALL ON public.data_karyawan_admin_pabrik TO anon, authenticated, service_role;
